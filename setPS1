#!/bin/env bash

BASE=/home/Administrator
rcfile=/cygdrive/c/Users/Administrator.AXX3DX8ZNMSGU5B/.qyh_vim/vimrc
export PROXY_HOST=192.168.3.152
PROXY_PORT=2333

main( ) {
    # set_working_dir "$@"
    set_PS1
    set_proxy
    clean_proxy
    # set_vimrc
    # set_PATH
    show_banner
    stty -ixon
    export desktop=/cygdrive/c/Users/Administrator.AXX3DX8ZNMSGU5B/Desktop
    source /etc/bash_completion.d/git
}

set_working_dir( ) {
    COMPILER_BASE=$BASE
    PROJECT_NAME=~/proj/PD1415D
    LIB_LOG_FILE=compile_lib.log
    if [ -z "$1" ] ; then
        export PROJECT_NAME=$(readlink -f $PROJECT_NAME)
    else
        export PROJECT_NAME=$(readlink -f $1)
    fi
    export llf=$PROJECT_NAME/$LIB_LOG_FILE
    export w=$PROJECT_NAME
    export w0=$COMPILER_BASE/tools
    # qcom
    export w1=$w/vendor/qcom/proprietary/mm-camera/
    export w1sdk=$w/vendor/qcom/proprietary/mm-camerasdk/
    export w11=$w1/mm-camera2/media-controller/modules/sensors/
    export w111=$w11/sensor/libs/imx298/
    export w2=$PROJECT_NAME/hardware/qcom/camera
    # mtk
    export wa=$w/vendor/mediatek/proprietary/platform/
    export wa1=$w/vendor/mediatek/proprietary/platform/mt6752/hardware/mtkcam/core/featureio/
    export wa2=$w/vendor/mediatek/proprietary/platform/mt6752/hardware/mtkcam/core/lib3a_sample/
    export wb=$w/vendor/mediatek/proprietary/custom/
    export ww=$w/qyh/
    export ww1=$w/qyh/mm-camera
    export ww3=$w/qyh/vivo-3a/stats
}

set_PS1( ) {
    PS1="\[\e]0;\w\a\]\n\[\e[32m\]\u@\h \[\e[33m\]\w\[\e[0m\]\n\$ "
}

set_proxy( ) {
    export http_proxy=$PROXY_HOST:$PROXY_PORT
    export https_proxy=$PROXY_HOST:$PROXY_PORT
}

clean_proxy( ) {
    export http_proxy=
    export https_proxy=
}

set_vimrc( ) {
    tmpfile=~/tmp.tmp.tmp.tmp
    flag_start="\" \[+\] generated by setPS1 start"
    flag_end="\" \[+\] generated by setPS1 end"
    line_start=$( grep -n "$flag_start" $rcfile | awk -F ":" '{print $1}' )
    line_end=$( grep -n "$flag_end" $rcfile | awk -F ":" '{print $1}' )
    cmd_t="set tags=$w1/tags,$w1sdk/tags,$w/kernel/tags,$w2/tags,$wa/tags,$wb/tags,$ww/tags"
    cmd_1="cs add $w1 $w1"
    cmd_1s="cs add $w1sdk $w1sdk"
    cmd_k="cs add $w/kernel $w/kernel"
    cmd_2="cs add $w2 $w2"
    cmd_a="cs add $wa $wa"
    cmd_b="cs add $wb $wb"
    cmd_w="cs add $ww $ww"
    if [ "x$line_start" != "x" ] ; then
        arg_sed="${line_start},${line_end}d"
        sed $arg_sed $rcfile > $tmpfile
    else
        cat $rcfile > $tmpfile
        echo "" >> $tmpfile
    fi
    echo ${flag_start//\\/} >> $tmpfile
    echo $cmd_t >> $tmpfile
    echo $cmd_1 >> $tmpfile
    echo $cmd_1s >> $tmpfile
    echo $cmd_k >> $tmpfile
    echo $cmd_2 >> $tmpfile
    echo $cmd_a >> $tmpfile
    echo $cmd_b >> $tmpfile
    echo $cmd_w >> $tmpfile
    echo ${flag_end//\\/} >> $tmpfile
    mv -f $tmpfile $rcfile
}

set_PATH( ) {
    export PATH=$PATH:$BASE/tools
}

show_banner( ) {
    clear
    cat $BASE/tools/banner.txt
}

vim_( ) {
    # alias vim_="vim -u $rcfile -S ~/qyh_session_vim.vim"
    vim -u "$rcfile" $*
}

ls( ){
    ls.exe -N -F --color=auto --show-control-chars $*
}

ll( ){
    ls.exe -N -lF --color=auto --show-control-chars $*
}

main "$@"